<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Iron Fist Tournament</title>

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
  color: #fdd835;
  text-align: center;
}
h1 {
  color: red;
  text-shadow: 0 0 15px #ff0000;
  font-size: 40px;
}
button {
  cursor: pointer;
  padding: 5px 12px;
  border-radius: 6px;
  margin: 3px;
  font-weight: 600;
}
.win-btn { background:red;color:#fff }
.lose-btn { background:#555;color:#fff }
.completed-match {
  background: rgba(0,255,0,0.15);
  border:1px solid #00ff37;
  box-shadow:0 0 10px #00ff3744;
  border-radius:6px;
  padding:5px;
}
.tick { color:#00ff37;font-size:20px;margin-left:6px }
.round-title { font-size:22px;margin-top:40px }
.trophy { font-size:26px;color:gold }
table {
  margin:25px auto;
  border-collapse:collapse;
  width:80%;
}
th,td { border:1px solid #fdd83566;padding:8px }
th { background:#222 }
</style>
</head>

<body>

<h1>Iron Fist Tournament</h1>

<h2 class="round-title">League Stage</h2>
<div id="matches"></div>

<h2 class="round-title">Leaderboard</h2>
<table id="leaderboard">
<thead>
<tr><th>Rank</th><th>Player</th><th>Wins</th><th>Losses</th><th>Points</th></tr>
</thead>
<tbody></tbody>
</table>

<h2 class="round-title">Knockout Rounds</h2>
<div id="knockout"></div>

<script>
/* ================= LEAGUE (UNCHANGED) ================= */

const players = [
"Naruto","Kakashi","Sai","Sakura","Neji","Rocklee","Tenten","Might Guy",
"Shikamaru","Ino","Choji","Asuma","Kiba","Shino","Hinata","Kurenai",
"Sasuke","Suigetsu","Karin","Jugo","Deidara","Hiruiko","Sasori","Tobi",
"Itachi","Kisame","Hidan","Kakuzu","Konan","Pain","Gaara","Temari",
"Kankuro","Chiyo","Yamato","Shizune","Tsunade","Jiraiya","Kabuto",
"Orochimaru","Minato","Small Obito","Small Kakashi","Hashirama"
];

let matches = [];
let scores = {};

function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

function generateMatches(){
  const used=new Set();
  players.forEach(p=>{
    if(!scores[p]) scores[p]={wins:0,losses:0,points:0};
    shuffle(players.filter(x=>x!==p)).slice(0,3).forEach(o=>{
      const k=[p,o].sort().join("-");
      if(!used.has(k)){
        matches.push({p1:p,p2:o,winner:null});
        used.add(k);
      }
    });
  });
}

function renderMatches(){
  const d=document.getElementById("matches");
  d.innerHTML="";
  matches.forEach((m,i)=>{
    d.innerHTML+=`
    <div class="${m.winner?'completed-match':''}">
      ${m.p1} vs ${m.p2} ${m.winner?"‚úîÔ∏è":""}<br>
      <button onclick="setWinner(${i},1)" ${m.winner?'disabled':''}>${m.p1} Win</button>
      <button onclick="setWinner(${i},2)" ${m.winner?'disabled':''}>${m.p2} Win</button>
    </div>`;
  });
}

function setWinner(i,w){
  const m=matches[i];
  if(m.winner) return;
  const a=m.p1,b=m.p2;
  if(w===1){m.winner=a;scores[a].wins++;scores[a].points+=3;scores[b].losses++;}
  else{m.winner=b;scores[b].wins++;scores[b].points+=3;scores[a].losses++;}
  renderMatches();renderLeaderboard();
}

function renderLeaderboard(){
  const tb=document.querySelector("#leaderboard tbody");
  const arr=Object.keys(scores).map(p=>({player:p,...scores[p]}))
    .sort((a,b)=>b.points-a.points||b.wins-a.wins);
  tb.innerHTML="";
  arr.forEach((p,i)=>{
    tb.innerHTML+=`<tr><td>${i+1}</td><td>${p.player}</td><td>${p.wins}</td><td>${p.losses}</td><td>${p.points}</td></tr>`;
  });
  renderKnockout(arr.slice(0,32));
}

/* ================= KNOCKOUT (NEW LOGIC) ================= */

let KO = JSON.parse(localStorage.getItem("KO")) || {R32:{},R16:{},QF:{},SF:{},FINAL:{}};
function saveKO(){ localStorage.setItem("KO",JSON.stringify(KO)); }

function setKO(round,key,winner){
  if(KO[round][key]) return;
  KO[round][key]=winner;
  saveKO();
  renderLeaderboard();
}

function winners(round){ return Object.values(KO[round]); }

function drawRound(title,players,round){
  let h=`<h3>${title}</h3>`;
  for(let i=0;i<players.length;i+=2){
    const a=players[i],b=players[i+1];
    const win=KO[round][i/2];
    h+=`
    <div class="${win?'completed-match':''}">
      ${a} vs ${b} ${win?"‚úîÔ∏è":""}<br>
      <button onclick="setKO('${round}','${i/2}','${a}')" ${win?'disabled':''}>${a} Win</button>
      <button onclick="setKO('${round}','${i/2}','${b}')" ${win?'disabled':''}>${b} Win</button>
    </div>`;
  }
  return h;
}

function renderKnockout(top32){
  const d=document.getElementById("knockout");
  let h="";
  const p32=top32.map(x=>x.player);

  h+=drawRound("Round of 32",p32,"R32");
  const r16=winners("R32");
  if(r16.length===16) h+=drawRound("Round of 16",r16,"R16");

  const qf=winners("R16");
  if(qf.length===8) h+=drawRound("Quarterfinals",qf,"QF");

  const sf=winners("QF");
  if(sf.length===4) h+=drawRound("Semifinals",sf,"SF");

  const f=winners("SF");
  if(f.length===2) h+=drawRound("Final",f,"FINAL");

  if(KO.FINAL["0"]) h+=`<h2>üèÜ Champion: ${KO.FINAL["0"]} <span class="trophy">üèÜ</span></h2>`;

  d.innerHTML=h;
  saveKO();
}

/* INIT */
generateMatches();
renderMatches();
renderLeaderboard();
</script>

</body>
</html>
