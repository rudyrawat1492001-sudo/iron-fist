<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iron Fist Tournament</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle, #101010, #000);
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 {
  color: #ff2e2e;
  text-shadow: 0 0 15px #ff0000;
}
.container {
  max-width: 1000px;
  margin: auto;
}
input, button {
  padding: 8px 14px;
  border-radius: 5px;
  border: none;
  font-size: 15px;
}
button {
  cursor: pointer;
  margin: 5px;
}
.add-btn { background: #28a745; color: #fff; }
.save-btn { background: #007bff; color: #fff; }
.reset-btn { background: #dc3545; color: #fff; }
.match, .round {
  background: rgba(255,255,255,0.08);
  border: 2px solid gold;
  border-radius: 10px;
  padding: 10px;
  margin: 10px auto;
  width: 80%;
  box-shadow: 0 0 10px gold;
}
.match span {
  font-size: 18px;
  color: gold;
}
.win-btn { background: #ff0000; color: #fff; }
.lose-btn { background: #555; color: #fff; }
table {
  width: 90%;
  margin: 10px auto;
  border-collapse: collapse;
}
table, th, td {
  border: 1px solid gold;
}
th, td {
  padding: 8px;
  color: #fff;
}
#winnerDisplay {
  font-size: 26px;
  color: gold;
  text-shadow: 0 0 10px #ff0;
  margin-top: 15px;
}
</style>
</head>
<body>
<h1>ü•ã Iron Fist Tournament ü•ã</h1>

<div class="container">
  <input id="playerName" placeholder="Enter player name">
  <button class="add-btn" onclick="addPlayer()">Add Player</button>
  <button class="save-btn" onclick="saveData()">Save</button>
  <button class="save-btn" onclick="loadData()">Load</button>
  <button class="reset-btn" onclick="resetAll()">Reset</button>
  <p id="playerCount"></p>
  
  <h2>League Stage (3 Matches Each)</h2>
  <div id="leagueMatches"></div>
  
  <button class="add-btn" onclick="calculateTop16()">Show Top 16</button>
  <div id="leaderboard"></div>

  <h2>Knockout Rounds</h2>
  <div id="rounds"></div>
  <div id="winnerDisplay"></div>
</div>

<script>
let players = [];
let matches = [];
let top16 = [];
const totalMatches = 3;

function addPlayer() {
  const name = document.getElementById('playerName').value.trim();
  if (!name) return alert("Enter player name!");
  if (players.length >= 44) return alert("Max 44 players reached!");
  players.push({ name, wins: 0, losses: 0, points: 0 });
  document.getElementById('playerName').value = '';
  renderPlayers();
  generateMatches();
  saveData();
}

function renderPlayers() {
  document.getElementById("playerCount").innerText = `Players: ${players.length}/44`;
}

function generateMatches() {
  matches = [];
  players.forEach(p => {
    const opponents = [...players].filter(x => x.name !== p.name);
    for (let i = 0; i < totalMatches; i++) {
      const o = opponents[Math.floor(Math.random() * opponents.length)];
      matches.push({ p1: p.name, p2: o.name, winner: null });
    }
  });
  renderMatches();
}

function renderMatches() {
  const div = document.getElementById("leagueMatches");
  div.innerHTML = '';
  matches.slice(0, 60).forEach((m, i) => {
    const matchDiv = document.createElement('div');
    matchDiv.className = 'match';
    matchDiv.innerHTML = `
      <span>üî• ${m.p1} vs ${m.p2}</span><br>
      <button class="win-btn" onclick="setWinner(${i}, '${m.p1}')">Win: ${m.p1}</button>
      <button class="win-btn" onclick="setWinner(${i}, '${m.p2}')">Win: ${m.p2}</button>
    `;
    div.appendChild(matchDiv);
  });
}

function setWinner(i, winner) {
  const match = matches[i];
  match.winner = winner;
  const loser = (match.p1 === winner) ? match.p2 : match.p1;

  const winPlayer = players.find(p => p.name === winner);
  const losePlayer = players.find(p => p.name === loser);

  winPlayer.wins++;
  winPlayer.points += 3;
  losePlayer.losses++;

  renderLeaderboard();
  saveData();
}

function renderLeaderboard() {
  players.sort((a, b) => b.points - a.points || b.wins - a.wins);
  const table = `
    <table>
      <tr><th>Rank</th><th>Player</th><th>Wins</th><th>Losses</th><th>Points</th></tr>
      ${players.map((p,i)=>`<tr><td>${i+1}</td><td>${p.name}</td><td>${p.wins}</td><td>${p.losses}</td><td>${p.points}</td></tr>`).join('')}
    </table>
  `;
  document.getElementById('leaderboard').innerHTML = table;
}

function calculateTop16() {
  const eligible = players.filter(p => p.wins >= 1);
  eligible.sort((a,b)=>b.points - a.points);
  top16 = eligible.slice(0,16);
  document.getElementById('leaderboard').innerHTML += `
    <h3 style="color:gold;">üèÜ Qualified Top 16</h3>
    ${top16.map(p=>`<div>${p.name}</div>`).join('')}
  `;
  buildKnockout(top16);
  saveData();
}

function buildKnockout(list) {
  const roundsDiv = document.getElementById('rounds');
  roundsDiv.innerHTML = '';
  const qf = buildRound(list, 16, "Round of 16");
  const sf = buildRound([], 8, "Quarterfinals");
  const f = buildRound([], 4, "Semifinals");
  const final = buildRound([], 2, "Final");
  roundsDiv.append(qf, sf, f, final);
}

function buildRound(playersList, count, title) {
  const div = document.createElement('div');
  div.className = 'round';
  div.innerHTML = `<h3>${title}</h3>`;
  for (let i=0; i<count/2; i++) {
    const p1 = playersList[i*2]?.name || "TBD";
    const p2 = playersList[i*2+1]?.name || "TBD";
    const m = document.createElement('div');
    m.className = 'match';
    m.innerHTML = `
      <span>${p1} vs ${p2}</span><br>
      <button class="win-btn" onclick="advance('${title}', '${p1}')">Win: ${p1}</button>
      <button class="win-btn" onclick="advance('${title}', '${p2}')">Win: ${p2}</button>
    `;
    div.appendChild(m);
  }
  return div;
}

function advance(round, winner) {
  if (round === "Final") {
    document.getElementById("winnerDisplay").innerHTML = `üèÜ Champion: <b>${winner}</b>`;
  }
}

function saveData() {
  localStorage.setItem('tournamentData', JSON.stringify({players, matches, top16}));
}
function loadData() {
  const data = JSON.parse(localStorage.getItem('tournamentData'));
  if (!data) return;
  players = data.players;
  matches = data.matches;
  top16 = data.top16;
  renderPlayers();
  renderMatches();
  renderLeaderboard();
}
function resetAll() {
  localStorage.clear();
  players = [];
  matches = [];
  top16 = [];
  document.getElementById('leagueMatches').innerHTML='';
  document.getElementById('leaderboard').innerHTML='';
  document.getElementById('rounds').innerHTML='';
  document.getElementById('winnerDisplay').innerHTML='';
}
</script>
</body>
</html>
