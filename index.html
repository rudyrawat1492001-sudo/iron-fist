<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iron Fist Tournament</title>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
      color: #fdd835;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      color: red;
      text-shadow: 0 0 15px #ff0000;
      font-size: 40px;
      margin-top: 20px;
    }

    button {
      cursor: pointer;
      padding: 5px 12px;
      border: none;
      border-radius: 6px;
      margin: 3px;
      font-weight: 600;
    }

    .win-btn {
      background: red;
      color: #fff;
    }

    .lose-btn {
      background: #555;
      color: #fff;
    }

    .save-btn {
      background: #4CAF50;
      color: white;
    }

    .reset-btn {
      background: #ff3d00;
      color: white;
    }

    .share-btn {
      background: #2962ff;
      color: white;
    }

    .completed-match {
      background: rgba(0, 255, 0, 0.15);
      border: 1px solid #00ff37;
      box-shadow: 0 0 10px #00ff3744;
      border-radius: 6px;
      padding: 5px;
    }

    .tick {
      color: #00ff37;
      font-size: 20px;
      font-weight: bold;
      margin-left: 6px;
    }

    table {
      margin: 25px auto;
      border-collapse: collapse;
      width: 80%;
      max-width: 1000px;
      background: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 20px #fdd83544;
    }

    th,
    td {
      border: 1px solid #fdd83566;
      padding: 8px;
    }

    th {
      background: #222;
      color: #fdd835;
    }

    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.05);
    }

    .round-title {
      font-size: 22px;
      margin-top: 40px;
      color: #fdd835;
      text-shadow: 0 0 10px #fdd835;
    }

    .trophy {
      font-size: 26px;
      color: gold;
      margin-left: 8px;
    }
  </style>
</head>

<body>

  <h1>Iron Fist Tournament</h1>

  <button onclick="saveData()" class="save-btn">üíæ Save Progress</button>
  <button onclick="loadData()" class="save-btn">üìÇ Load Saved</button>
  <button onclick="resetAll()" class="reset-btn">üîÑ Reset All</button>
  <button onclick="getShareLink()" class="share-btn">üîó Share Progress</button>

  <h2 class="round-title">League Stage (3 Matches Each)</h2>
  <div id="matches"></div>

  <h2 class="round-title">Leaderboard</h2>

  <table id="leaderboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Player</th>
        <th>Wins</th>
        <th>Losses</th>
        <th>Points</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2 class="round-title">Knockout Rounds</h2>
  <div id="knockout"></div>

  <script>
    /* PLAYERS */
    const players = [
      "Naruto", "Kakashi", "Sai", "Sakura", "Neji", "Rocklee", "Tenten", "Might Guy",
      "Shikamaru", "Ino", "Choji", "Asuma", "Kiba", "Shino", "Hinata", "Kurenai",
      "Sasuke", "Suigetsu", "Karin", "Jugo", "Deidara", "Hiruiko", "Sasori", "Tobi",
      "Itachi", "Kisame", "Hidan", "Kakuzu", "Konan", "Pain", "Gaara", "Temari",
      "Kankuro", "Chiyo", "Yamato", "Shizune", "Tsunade", "Jiraiya", "Kabuto",
      "Orochimaru", "Minato", "Small Obito", "Small Kakashi", "Hashirama"
    ];

    let matches = [];
    let scores = {};

    /* SHUFFLE */
    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    /* GENERATE MATCHES */
    function generateMatches() {
      const usedPairs = new Set();

      for (let i = 0; i < players.length; i++) {
        const p = players[i];

        if (!scores[p]) {
          scores[p] = { wins: 0, losses: 0, points: 0 };
        }

        const opponents = shuffle(players.filter(x => x !== p));
        let count = 0;

        for (let o of opponents) {
          const key = [p, o].sort().join("-");

          if (!usedPairs.has(key)) {
            matches.push({ p1: p, p2: o, winner: null });
            usedPairs.add(key);
            count++;

            if (count === 3) break;
          }
        }
      }
    }

    /* RENDER MATCHES */
    function renderMatches() {
      const div = document.getElementById("matches");
      div.innerHTML = "";

      matches.forEach((m, i) => {
        const box = document.createElement("div");
        box.className = m.winner ? "completed-match" : "";

        box.innerHTML = `
          <p>üî• ${m.p1} vs ${m.p2} ${m.winner ? "<span class='tick'>‚úîÔ∏è</span>" : ""}</p>
          <button class="win-btn" onclick="setWinner(${i}, 1)" ${m.winner ? "disabled" : ""}>${m.p1} Win</button>
          <button class="lose-btn" onclick="setWinner(${i}, 2)" ${m.winner ? "disabled" : ""}>${m.p2} Win</button>
          <hr style="width:60%;opacity:0.2;">
        `;

        div.appendChild(box);
      });
    }

    /* SET WINNER */
    function setWinner(index, winner) {
      const match = matches[index];
      if (match.winner) return;

      let p1 = match.p1;
      let p2 = match.p2;

      if (winner === 1) {
        match.winner = p1;
        scores[p1].wins++;
        scores[p1].points += 3;
        scores[p2].losses++;
      } else {
        match.winner = p2;
        scores[p2].wins++;
        scores[p2].points += 3;
        scores[p1].losses++;
      }

      saveData();
      renderMatches();
      renderLeaderboard();
    }

    /* LEADERBOARD */
    function renderLeaderboard() {
      const tbody = document.querySelector("#leaderboard tbody");

      const arr = Object.keys(scores).map(p => ({
        player: p,
        ...scores[p]
      }));

      arr.sort((a, b) => b.points - a.points || b.wins - a.wins);
      tbody.innerHTML = "";

      arr.forEach((p, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${p.player}</td>
            <td>${p.wins}</td>
            <td>${p.losses}</td>
            <td>${p.points}</td>
          </tr>
        `;
      });

      renderKnockout(arr.slice(0, 32));
    }

    /* KNOCKOUT */
    let knockoutData = JSON.parse(localStorage.getItem("knockoutData")) || {};

    function renderKnockout(top32) {
      const div = document.getElementById("knockout");
      if (!top32.length) return;

      let html = "<h3>Round of 32</h3>";

      for (let i = 0; i < 16; i++) {
        const a = top32[i].player;
        const b = top32[31 - i].player;
        const key = `R32-${a}-${b}`;
        const winner = knockoutData[key];

        html += `
          <p class="${winner ? 'completed-match' : ''}">
            ${a} vs ${b}
            ${winner ? "<span class='tick'>‚úîÔ∏è</span>" : ""}
            <br>
            <button onclick="setKO('${key}','${a}')" ${winner ? 'disabled' : ''}>${a} Win</button>
            <button onclick="setKO('${key}','${b}')" ${winner ? 'disabled' : ''}>${b} Win</button>
          </p>
        `;
      }

      html += "<h3>Round of 16 ‚Üí Quarterfinals ‚Üí Semifinals ‚Üí Final</h3>";
      html += "<p>Auto progression based on winners</p>";

      const champ = knockoutData['CHAMPION'];
      if (champ) {
        html += `<h2>üèÜ Champion: ${champ} <span class='trophy'>üèÜ</span></h2>`;
      }

      div.innerHTML = html;
      localStorage.setItem("knockoutData", JSON.stringify(knockoutData));
    }

    function setKO(key, winner) {
      knockoutData[key] = winner;

      const wins = Object.values(knockoutData).filter(v => v === winner).length;
      if (wins >= 5) {
        knockoutData['CHAMPION'] = winner;
      }

      localStorage.setItem("knockoutData", JSON.stringify(knockoutData));
      renderLeaderboard();
    }

    /* SAVE LOAD */
    function saveData() {
      localStorage.setItem("ironFistData", JSON.stringify({ matches, scores }));
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("ironFistData"));

      if (data) {
        matches = data.matches;
        scores = data.scores;
        renderMatches();
        renderLeaderboard();
      }
    }

    /* RESET */
    function resetAll() {
      if (!confirm("Reset all data?")) return;

      localStorage.removeItem("ironFistData");
      matches = [];
      scores = {};

      generateMatches();
      renderMatches();
      renderLeaderboard();
    }

    /* SHARE URL */
    function getShareLink() {
      const encoded = btoa(JSON.stringify({ matches, scores }));
      const url = window.location.href.split("?")[0] + "?data=" + encoded;

      navigator.clipboard.writeText(url);
      alert("Share Link Copied! üìé");
    }

    /* URL LOAD */
    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      const d = params.get("data");
      if (!d) return;

      try {
        const parsed = JSON.parse(atob(d));
        matches = parsed.matches;
        scores = parsed.scores;
        localStorage.setItem("ironFistData", JSON.stringify(parsed));
        alert("Progress Loaded from Shared Link!");
      } catch {
        alert("Invalid Link!");
      }
    }

    /* INIT FIXED */
    function init() {
      loadFromURL();

      const saved = JSON.parse(localStorage.getItem("ironFistData"));

      if (saved) {
        matches = saved.matches;
        scores = saved.scores;
      } else {
        generateMatches();
      }

      renderMatches();
      renderLeaderboard();
    }

    init();
  </script>

</body>
</html>
