<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Iron Fist Tournament</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Poppins,sans-serif;
  background:radial-gradient(circle,#1a1a1a,#000);
  color:#fdd835;
  text-align:center;
}
h1{color:red;text-shadow:0 0 15px red}
button{
  padding:5px 10px;
  margin:3px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.win-btn{background:red;color:white}
.reset-btn{background:#ff3d00;color:white}
.completed-match{
  background:rgba(0,255,0,0.15);
  border:1px solid #00ff37;
  padding:5px;
  border-radius:6px;
}
.tick{color:#00ff37;font-weight:bold}
table{
  margin:20px auto;
  border-collapse:collapse;
  width:80%;
}
th,td{
  border:1px solid #fdd83566;
  padding:6px;
}
th{background:#222}
.round-title{font-size:22px;margin-top:35px}
</style>
</head>

<body>

<h1>Iron Fist Tournament</h1>
<button class="reset-btn" onclick="resetAll()">üîÑ Reset All</button>

<h2 class="round-title">League Matches</h2>
<div id="league"></div>

<h2 class="round-title">Leaderboard (Top 32)</h2>
<table>
<thead><tr><th>Rank</th><th>Player</th><th>Pts</th></tr></thead>
<tbody id="board"></tbody>
</table>

<h2 class="round-title">Knockout Stage</h2>
<div id="knockout"></div>

<script>
const STORAGE = 'ironFist_v2';

const players = [
"Naruto","Kakashi","Sai","Sakura","Neji","Rocklee","Tenten","Might Guy",
"Shikamaru","Ino","Choji","Asuma","Kiba","Shino","Hinata","Kurenai",
"Sasuke","Suigetsu","Karin","Jugo","Deidara","Sasori","Tobi","Itachi",
"Kisame","Hidan","Kakuzu","Konan","Pain","Gaara","Temari","Kankuro",
"Chiyo","Yamato","Tsunade","Jiraiya","Kabuto","Orochimaru","Minato",
"Obito","Hashirama","Madara","Shisui"
];

let state={
  league:[],
  scores:{},
  KO:{ r32:[], r16:[], qf:[], sf:[], final:[], champion:null }
};

// ---------- SAVE / LOAD ----------
function save(){
  localStorage.setItem(STORAGE,JSON.stringify(state));
}
function load(){
  const d=localStorage.getItem(STORAGE);
  if(d){ state=JSON.parse(d); return true;}
  return false;
}

// ---------- INIT ----------
function init(){
  players.forEach(p=>state.scores[p]={pts:0});
  for(let i=0;i<players.length;i++){
    for(let j=i+1;j<i+4 && j<players.length;j++){
      state.league.push({a:players[i],b:players[j],w:null});
    }
  }
  save();
}
if(!load()) init();

// ---------- LEAGUE ----------
function renderLeague(){
  const d=document.getElementById('league');
  d.innerHTML='';
  state.league.forEach((m,i)=>{
    const done=m.w;
    d.innerHTML+=`
    <div class="${done?'completed-match':''}">
      ${m.a} vs ${m.b}
      ${!done?`
      <button class="win-btn" onclick="winLeague(${i},'a')">${m.a}</button>
      <button class="win-btn" onclick="winLeague(${i},'b')">${m.b}</button>`:
      `<span class="tick">‚úî</span>`}
    </div>`;
  });
}

function winLeague(i,s){
  if(state.league[i].w) return;
  const w=s==='a'?state.league[i].a:state.league[i].b;
  state.league[i].w=w;
  state.scores[w].pts+=3;
  save();
  renderLeague();
  renderBoard();
}

// ---------- LEADERBOARD ----------
function renderBoard(){
  let arr=Object.keys(state.scores)
    .map(p=>({p,pts:state.scores[p].pts}))
    .sort((a,b)=>b.pts-a.pts);

  const tb=document.getElementById('board');
  tb.innerHTML='';
  arr.forEach((x,i)=>{
    tb.innerHTML+=`<tr><td>${i+1}</td><td>${x.p}</td><td>${x.pts}</td></tr>`;
  });

  if(state.KO.r32.length===0){
    startKO(arr.slice(0,32).map(x=>x.p));
  }
}

// ---------- KNOCKOUT ----------
function startKO(list){
  state.KO.r32=[];
  for(let i=0;i<16;i++){
    state.KO.r32.push({a:list[i],b:list[31-i],w:null});
  }
  save();
}

function renderKO(){
  const d=document.getElementById('knockout');
  d.innerHTML='';
  drawRound('Round of 32','r32',16);
  drawRound('Round of 16','r16',8);
  drawRound('Quarterfinal','qf',4);
  drawRound('Semifinal','sf',2);
  drawFinal();
}

function drawRound(title,key,c){
  if(state.KO[key].length===0) return;
  let h=`<h3>${title}</h3>`;
  state.KO[key].forEach((m,i)=>{
    h+=`
    <div class="${m.w?'completed-match':''}">
    ${m.a} vs ${m.b}
    ${!m.w?`
    <button onclick="winKO('${key}',${i},'a')">Win</button>
    <button onclick="winKO('${key}',${i},'b')">Win</button>`:
    `<span class="tick">‚úî</span>`}
    </div>`;
  });
  knockout.innerHTML+=h;
}

function winKO(r,i,s){
  let m=state.KO[r][i];
  if(m.w) return;
  m.w=s==='a'?m.a:m.b;

  const map={r32:'r16',r16:'qf',qf:'sf',sf:'final'};
  if(map[r]){
    state.KO[map[r]].push({a:m.w,b:null,w:null});
    if(state.KO[map[r]].length%2===0){
      let x=state.KO[map[r]];
      let b=x.pop().a, a=x.pop().a;
      x.push({a,b,w:null});
    }
  }
  if(r==='final'){
    state.KO.champion=m.w;
  }
  save();
  renderKO();
}

function drawFinal(){
  if(state.KO.final.length===1){
    let m=state.KO.final[0];
    knockout.innerHTML+=`
    <h3>Final</h3>
    <div class="${m.w?'completed-match':''}">
    ${m.a} vs ${m.b}
    ${!m.w?`
    <button onclick="winKO('final',0,'a')">Win</button>
    <button onclick="winKO('final',0,'b')">Win</button>`:
    `<h2>üèÜ Champion: ${state.KO.champion}</h2>`}
    </div>`;
  }
}

// ---------- RESET ----------
function resetAll(){
  if(!confirm('Reset everything?')) return;
  localStorage.removeItem(STORAGE);
  location.reload();
}

// ---------- RENDER ----------
renderLeague();
renderBoard();
renderKO();
</script>

</body>
</html>
